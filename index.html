<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Slot Machine</title>
  <link rel="stylesheet" href="./style.css">

</head>

<body>
  <div class="game_container">
    <div class="mask">
      <div class="winningContainer" style="z-index: 200;">
        <img class="winning" src="./img/$$$.jpg" />
        <img class="winning" src="./img/$$$.jpg" />
        <img class="winning" src="./img/$$$.jpg" />
      </div>
      <div class="slots"></div>
    </div>
    <p class="winningLabel">MAKE $600,000 IN LESS THAN 12 MONTHS</p>
    <div class="label"></div>
    <div class="btn_container">
      <div class="spin_btn">
        <img src="img/btn-hover.png" />
        <img id="btnHover" src="img/btn-normal.png" />
      </div>
    </div>
    <img class="finalImage" src="./img/final.png" />
  </div>
  <video src="./img/lasvegas1.mp4" onloadedmetadata="this.muted = true" playsinline autoplay muted loop></video>
  </div>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <script>
    $(document).ready(function () {

      $(".game_container").hide()
      $(".winningContainer").hide()
      $(".winningLabel").hide()
      $("#btnHover").removeClass("hide");
      setTimeout(() => {
        $("video").fadeOut(2000)
        $(".game_container").fadeIn(3000)
      }, 110);

      var slots = $(".slots")
      for (var i = 0; i < 3; i++) {
        slots.append("<div class='item'>")
        for (var j = 0; j < 8; j++) {
          slots.children().last().append("<div>")
        }
      }

      var isAnimate = false,
        isWin = true,
        level = 10, //60%
        randomNum,
        winNums = [],
        slotsItem = $(".slots .item"),
        allImages = [
          ["asian-1", "asian-2", "asian-3", "asian-4", "asian-5"],
          ["blonde-1", "blonde-2", "blonde-3", "blonde-4"],
          ["brunettes-1", "brunettes-2", "brunettes-3"],
          ["busty-1", "busty-2", "busty-3"],
          ["teens-1", "teens-2", "teens-3"]],
        // allImages = ["img1-1", "img2-2", "img3-3", "img4-4", "img5-5", "img6-6", "img7-7", "img8-8", "img9-9", "img10-10", "img11-11", "img12-12", "img13-13", "img14-14", "img15-15", "img16-16", "img17-17", "img18-18",],
        tempImages = allImages.slice(),
        currentImages = [],
        salute = $(".salute"),
        wonKind = undefined,
        itemNo = slotsItem.eq(0).children().length,
        start = new Audio("./audio/start.mp3"),
        lose = new Audio("./audio/lose.mp3"),
        winAudio = new Audio("./audio/win.mp3")

      reset()
      function reset() {
        isWin = Math.floor(Math.random() * 10) < level ? true : false
        currentImages = []
        tempImages = allImages.slice()
        if (isWin) {
          for (i = tempImages.length-1; i >= 0; i--) {
            wonKind = Math.floor(Math.random() * tempImages.length)
            currentImages = currentImages.concat(tempImages.pop(wonKind))
          }
          currentImages = currentImages.slice(0,8)
        }
        console.log("wonKind", wonKind, "currentImages", currentImages)

        // tempImages = [].concat(allImages)
        // for (var i = 0; i < itemNo; i++) {
        //   ranNo = Math.floor(Math.random() * tempImages.length)
        //   currentImages.push(tempImages[ranNo])
        //   tempImages.splice(ranNo, 1)
        // }

        // for (var i = 0; i < 3; i++) {
        //   slotsItem = $(".slots .item")
        //   for (var j = 0; j < itemNo; j++) {
        //     slotsItem.eq(i).children().eq(j).css("background-image", "url(./img/" + currentImages[j] + ".jpg)")
        //   }
        // }

      }
      $(".spin_btn").on("click", function () {
        if (!isAnimate) {
          reset()
          start.play()
          $("#btnHover").addClass("hide");
          $(".winningContainer").hide()
          $(".winningLabel").hide()
          $(".finalImage").hide()
          $(".label").html("")
          $(".spin_btn").children().last().css("display", "hidden")
          ran = Math.random()
          isWin = Math.floor(ran * 10) < level ? true : false
          isAnimate = true
          salute.removeClass("active");
          $(this).addClass("active");
          // randomNum = Math.ceil(Math.random() * itemNo)
          winNums = getResult(currentImages, isWin)
          isWin = winNums ? false : isWin
          console.log(isWin, ran, 'winNums', winNums)

          for (var i = 0; i < 3; i++) {
            slotsItem.eq(i).removeClass('state' + winNums[i]);

            // if (win) winNums[i] = randomNum
            // else {//lose
            //   winNums[i] = Math.ceil(Math.random() * itemNo)
            //   if (winNums[0] == winNums[1] && winNums[0] == winNums[2]) {
            //     winNums = [1, 2, 3]
            //   }
            // }
            // winNums[i] = randomNum


            slotsItem.eq(i).addClass("animate").addClass('state' + winNums[i]);
          }


          setTimeout(function () {

            if (isWin) {
              winAudio.play()
              name = currentImages[winNums[0] - 1]
              console.log(name.split('-')[0])
              $(".label").html(name.split('-')[0])
              $(".winningContainer").delay(1000).fadeIn(2000)
              $(".winningLabel").fadeIn(2000, function () {
                $(".finalImage").delay(3000).fadeIn(2000)
                $(".winningLabel").delay(3000).fadeOut(2000, function () {
                  slotsItem.removeClass("animate");
                  isAnimate = false;
                  $(".spin_btn").removeClass("active");
                  $("#btnHover").removeClass("hide");
                })
              })
            } else {
              lose.play()
              slotsItem.removeClass("animate");
              isAnimate = false;
              $(".spin_btn").removeClass("active");
              $("#btnHover").removeClass("hide");
            }
          }, 8000);
        }
      });

      function getResult(currentImages) {
        var compare = 0;
        var mostFrequent;
        var currentNames = []
        var rs = []

        for (var i = 0; i < currentImages.length; i++) {
          var word = currentImages[i].split("-")[0];
          currentNames.push(word)
        }

        for (var i = 0; i < currentNames.length; i++) {
          rs.length = 0;
          for (var j = 0; j < currentNames.length; j++) {
            if (i == j) {
              rs.push(j + 1)
              continue
            }

            if (currentNames[i] == currentNames[j] && isWin) {
              rs.push(j + 1)
            } else if (!isWin && currentNames[i] != currentNames[j]) {
              rs.push(j + 1)
            }

            if (rs.length >= 3) {
              return (rs)
              break
            }
          }
        }
        return null
      }
    });
//the video runs for 13 seconds then fades to the slot site attached is the Blondes thats the first after
//the video then whatever you choose TEENS, BUSTY, ASIANS then the $$$ then see the attached 
//WE TURN FANTASY INTO REALITY to include money@lasvegas.xxx just the words as I have not purchased the email yet.



  </script>

</body>

</html>